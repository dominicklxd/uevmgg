<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Administrar Usuarios - Unidad Educativa Víctor Manuel Guzmán</title>
    <link rel="stylesheet" href="css.css">
    <style>
        .usuarios-section {
            max-width: 1100px;
            margin: 3rem auto 2rem auto;
            background: #fff;
            border-radius: 18px;
            box-shadow: 0 8px 32px rgba(44,130,201,0.10);
            padding: 2.5rem 2rem;
        }
        .usuarios-section h2 {
            color: #2f5597;
            font-size: 2rem;
            margin-bottom: 1.2rem;
            text-align: center;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 2rem;
        }
        th, td {
            padding: 0.7rem 0.5rem;
            border-bottom: 1px solid #eee;
            text-align: left;
        }
        th {
            background: #e8f5e9;
            color: #2f5597;
        }
        tr:hover {
            background: #f6f6fa;
        }
        select {
            padding: 0.3rem 0.7rem;
            border-radius: 6px;
            border: 1px solid #ccc;
        }
        .btn-rol {
            background: #548235;
            color: #fff;
            border: none;
            border-radius: 6px;
            padding: 0.4em 1.2em;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.2s, transform 0.2s;
        }
        .btn-rol:hover {
            background: #2f5597;
            transform: scale(1.05);
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
</head>
<body>
    <div class="top-info-bar">
        <p> Av. El Retorno 5-130 y Av. Ricardo Sánchez, Ibarra, Ecuador | uevmg@gmail.com</p>
    </div>
    <header>
        <div class="header-top">
            
            <img src="unidad-educativa-logo.png" alt="Logo de la Institución" class="logo">
            <div class="header-text">
                <h1>Unidad Educativa </h1>
                <h1>"Víctor Manuel Guzmán"</h1>
                <p>50 años de Educación Estudiantil</p>
            </div>
            <div class="auth-links">
                <!-- Los enlaces se gestionarán dinámicamente desde script.js -->
            </div>
            <div id="saludo-usuario" style="position:absolute; right:30px; bottom:-30px; font-size:1.1rem; color:#2f5597; font-weight:bold; background:rgba(255,255,255,0.95); border-radius:8px; padding:0.3em 1em; box-shadow:0 2px 8px rgba(0,0,0,0.08); display:none; z-index:10;">
                <!-- Aquí se mostrará el saludo -->
            </div>
            <nav>
                <ul class="menu">
                    <li><a href="index.html">Inicio</a></li>
                    <li class="dropdown">
                        <a href="#">Nosotros</a>
                        <ul class="submenu">
                            <li><a href="quienes-somos.html">Quiénes Somos</a></li>
                            <li><a href="autoridades.html">Autoridades</a></li>
                            <li><a href="historia.html">Historia</a></li>
                            <li><a href="ambientes.html">Sede y Ambientes</a></li>
                            <li><a href="simbolos.html">Símbolos Institucionales</a></li>
                            <li><a href="#oferta-educativa">Oferta Educativa</a></li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#">Docentes</a>
                        <ul class="submenu">
                            <li><a href="calendario.html">Cronograma de Actividades</a></li>
                            <li><a href="sistemas-ministerio-educacion.html">Sistemas del Ministerio de Educación</a></li>
                            
                            <li><a href="#recursos">Recursos Didácticos</a></li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#">Padres de Familia</a>
                        <ul class="submenu">
                            <li><a href="comite-padres.html">Comité Central de Padres de Familia</a></li>
                            <li><a href="#horario-padres">Horario de Atención a Padres de Familia</a></li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#">Estudiantes</a>
                        <ul class="submenu">
                            <li><a href="consejo-estudiantil.html">Consejo Estudiantil</a></li>
                            <li><a href="cuadro-honor.html">Cuadro de Honor</a></li>
                            <li><a href="horario-clases.html">Horario de Clases</a></li>
                            <li><a href="#uniforme-escolar">Uniforme Escolar</a></li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#">Servicios</a>
                        <ul class="submenu">
                            <li><a href="#aula-virtual">Aula Virtual Institucional</a></li>
                            <li><a href="dece.html">DECE</a></li>
                           
                            
                            <li><a href="#bar-institucional">Bar Institucional</a></li>
                            <li><a href="#banda-musical">Banda Musical</a></li>
                            <li><a href="#biblioteca-virtual">Biblioteca Virtual</a></li>
                            
                            <li><a href="#bastoneras">Grupo de Bastoneras y Cachiporreros</a></li>
                        </ul>
                    </li>
                    <li><a href="contactos.html">Contactos</a></li>
                </ul>
            </nav>
        </div>
    </header>
    <main style="margin-top: 120px;">
        <section class="usuarios-section">
            <h2>Administrar Roles de Usuarios</h2>
            <table id="tabla-usuarios">
                <thead>
                    <tr>
                        <th>Usuario</th>
                        <th>Email</th>
                        <th>Rol Actual</th>
                        <th>Nuevo Rol</th>
                        <th>Acción</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Usuarios se llenan dinámicamente -->
                </tbody>
            </table>
        </section>
    </main>
    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>UNIDAD EDUCATIVA "VICTOR MANUEL GUZMAN"</h3>
                <div class="footer-line"></div>
                <p>Todos los contenidos digitales del portal web, se prohíbe su reproducción total, parcial y traducción a cualquier idioma sin autorización escrita por su titular.</p>
            </div>
            <div class="footer-section">
                <h3>ACCESOS DIRECTOS</h3>
                <div class="footer-line"></div>
                <ul>
                    <li><a href="index.html">Inicio</a></li>
                    <li><a href="registro.html">Registro</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>CONTACTOS</h3>
                <div class="footer-line"></div>
                <p>(09) 096 305 3811</p>
                <p> uevmg2023@gmail.com</p>
                <p>De lunes a viernes: 07:00 - 17:00</p>
            </div>
            <div class="footer-section">
                <h3>UBICACIÓN</h3>
                <div class="footer-line"></div>
                <div style="margin-top:5px; text-align:center;">
                    <iframe 
                        src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d1994.874824133404!2d-78.11604869660802!3d0.33616444871436085!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x8e2a3cd3c813c32d%3A0xf395292710b25406!2sUnidad%20Educativa%20V%C3%ADctor%20Manuel%20Guzm%C3%A1n!5e0!3m2!1ses-419!2sec!4v1744093697198!5m2!1ses-419!2sec" 
                        width="180" height="110" style="border:0;border-radius:8px;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade">
                    </iframe>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>Unidad Educativa Victor Manuel Guzmán © Copyrights 2025 Realizado por Dominick López, Juan Alba y Hugo Castillo</p>
        </div>
    </footer>
    <script>
        // Configuración de Supabase
        const supabaseUrl = "https://zeijayrxciyzymysbyvp.supabase.co";
        const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InplaWpheXJ4Y2l5enlteXNieXZwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQxNjYyMjMsImV4cCI6MjA1OTc0MjIyM30.DxT8_5acA88JxhVV7n2UqmrZ_9d0DPABi6eKSO8cpDE";
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        // Lista de roles posibles
        const roles = [
            "estudiante",
            "profesor",
            "rector",
            "vicerrector",
            "administrador",
            "anunciador"
        ];

        // Cargar usuarios y mostrar tabla
        async function cargarUsuarios() {
            // Cambia 'usuarios' y los campos según tu estructura real
            let { data: usuarios, error } = await supabase
                .from('usuarios')
                .select('id, usuario, email, rol');
            if (error) {
                alert("Error al cargar usuarios");
                return;
            }
            const tbody = document.querySelector("#tabla-usuarios tbody");
            tbody.innerHTML = "";
            usuarios.forEach(u => {
                const tr = document.createElement("tr");
                tr.innerHTML = `
                    <td>${u.usuario || ''}</td>
                    <td>${u.email || ''}</td>
                    <td>${u.rol || ''}</td>
                    <td>
                        <select>
                            ${roles.map(r => `<option value="${r}" ${u.rol === r ? 'selected' : ''}>${r.charAt(0).toUpperCase() + r.slice(1)}</option>`).join('')}
                        </select>
                    </td>
                    <td>
                        <button class="btn-rol" data-id="${u.id}">Actualizar Rol</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });

            // Asignar eventos a los botones
            document.querySelectorAll('.btn-rol').forEach(btn => {
                btn.onclick = async function() {
                    const id = this.getAttribute('data-id');
                    const select = this.parentElement.parentElement.querySelector('select');
                    const nuevoRol = select.value;
                    const { error } = await supabase
                        .from('usuarios')
                        .update({ rol: nuevoRol })
                        .eq('id', id);
                    if (!error) {
                        alert('Rol actualizado correctamente');
                        cargarUsuarios();
                    } else {
                        alert('Error al actualizar el rol');
                    }
                };
            });
        }

        window.addEventListener('DOMContentLoaded', cargarUsuarios);
    </script>
</body>
</html>