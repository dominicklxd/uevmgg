<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iniciar Sesión</title>
    <link rel="stylesheet" href="css.css">
    <style>
        body {
            background: linear-gradient(135deg, #eaf2fb 60%, #b7d1f3 100%);
            font-family: 'Raleway', Arial, sans-serif;
            min-height: 100vh;
            /* Añadir detalles institucionales */
            position: relative;
            overflow-x: hidden;
        }
        body::before {
            content: "";
            position: fixed;
            top: -80px;
            left: -80px;
            width: 350px;
            height: 350px;
            background: radial-gradient(circle, #2f5597 0%, #eaf2fb 80%);
            opacity: 0.13;
            z-index: 0;
            border-radius: 50%;
        }
        body::after {
            content: "";
            position: fixed;
            bottom: -120px;
            right: -120px;
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, #548235 0%, #eaf2fb 80%);
            opacity: 0.11;
            z-index: 0;
            border-radius: 50%;
        }
        /* Solo estilos del cuerpo de login */
        .auth-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 80vh;
            padding: 2rem 0;
            position: relative;
            z-index: 1;
        }
        .auth-box {
            background: #fff;
            border-radius: 24px;
            box-shadow: 0 12px 48px rgba(44,130,201,0.18);
            padding: 3.5rem 3.2rem 2.8rem 3.2rem;
            max-width: 480px;
            width: 100%;
            text-align: center;
            position: relative;
            transition: box-shadow 0.2s, transform 0.2s;
        }
        .auth-box:hover {
            box-shadow: 0 18px 64px rgba(44,130,201,0.22);
            transform: translateY(-4px) scale(1.015);
        }
        .auth-box img.logo-login {
            width: 110px;
            height: 110px;
            object-fit: contain;
            margin-bottom: 1.2rem;
            border-radius: 16px;
            box-shadow: 0 2px 16px rgba(44,130,201,0.13);
            background: #f8fafd;
            border: 2.5px solid #2f5597;
        }
        .auth-box h2 {
            color: #2f5597;
            font-family: 'Roboto Slab', serif;
            font-size: 2rem;
            margin-bottom: 1.2rem;
            font-weight: bold;
            letter-spacing: 1px;
        }
        .auth-box label {
            display: block;
            text-align: left;
            color: #2f5597;
            font-weight: 600;
            margin-bottom: 0.2em;
            margin-top: 1em;
            font-size: 1.08em;
        }
        .auth-box input[type="text"],
        .auth-box input[type="password"] {
            width: 90%;
            padding: 0.7em 1.1em;
            border: 1.5px solid #b7d1f3;
            border-radius: 10px;
            margin-bottom: 0.9em;
            font-size: 1.08em;
            background: #f8fafd;
            transition: border 0.18s, box-shadow 0.18s;
            box-shadow: 0 1px 4px #2f55970a;
        }
        .auth-box input[type="text"]:focus,
        .auth-box input[type="password"]:focus {
            border-color: #2f5597;
            outline: none;
            box-shadow: 0 2px 8px #2f55971a;
        }
        #captcha-container label {
            color: #548235;
            font-weight: bold;
            margin-top: 0.7em;
        }
        #captcha-container input[type="text"] {
            margin-top: 0.3em;
        }
        .auth-box button[type="submit"] {
            background: linear-gradient(90deg, #548235 60%, #2f5597 100%);
            color: #fff;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            padding: 0.8em 2.5em;
            font-size: 1.18em;
            margin-top: 1.5em;
            cursor: pointer;
            transition: background 0.18s, transform 0.18s, box-shadow 0.18s;
            box-shadow: 0 2px 12px rgba(44,130,201,0.10);
            letter-spacing: 0.5px;
        }
        .auth-box button[type="submit"]:hover {
            background: linear-gradient(90deg, #2f5597 60%, #548235 100%);
            transform: scale(1.04);
            box-shadow: 0 6px 24px rgba(44,130,201,0.16);
        }
        .login-footer-links {
            margin-top: 2em;
            font-size: 1.05em;
        }
        .login-footer-links a {
            color: #2f5597;
            text-decoration: underline;
            margin: 0 0.5em;
            font-weight: 600;
        }
        .login-footer-links a:hover {
            color: #548235;
        }
        @media (max-width: 700px) {
            .auth-box {
                padding: 1.5rem 0.7rem 1.5rem 0.7rem;
                max-width: 98vw;
            }
            .auth-box img.logo-login {
                width: 80px;
                height: 80px;
            }
        }
    </style>
</head>
<body>
    <div class="top-info-bar">
        <p> Av. El Retorno 5-130 y Av. Ricardo Sánchez, Ibarra, Ecuador | uevmg@gmail.com</p>
    </div>
    <header>
    <div class="header-top">
        <img src="unidad-educativa-logo.png" alt="Logo de la Institución" class="logo">
        <div class="header-text">
            <h1>Unidad Educativa </h1>
            <h1>"Víctor Manuel Guzmán"</h1>
            <p>Educando para la vida</p>
        </div>
        <div class="auth-links">
            <!-- Los enlaces se gestionarán dinámicamente desde script.js -->
        </div>
        <div id="saludo-usuario" style="position:absolute; right:30px; bottom:-30px; font-size:1.1rem; color:#2f5597; font-weight:bold; background:rgba(255,255,255,0.95); border-radius:8px; padding:0.3em 1em; box-shadow:0 2px 8px rgba(0,0,0,0.08); display:none; z-index:10;">
            <!-- Aquí se mostrará el saludo -->
        </div>
        <nav>
            <ul class="menu">
                <li><a href="index.html">Inicio</a></li>
                <li class="dropdown">
                    <a href="#">Nosotros</a>
                    <ul class="submenu">
                        <li><a href="quienes-somos.html">Quiénes Somos</a></li>
                        <li><a href="autoridades.html">Autoridades</a></li>
                        <li><a href="ambientes.html">Sede y Ambientes</a></li>
                        <li><a href="simbolos.html">Símbolos Institucionales</a></li>
                        <li><a href="oferta-educativa.html">Oferta Educativa</a></li>
                        <li><a href="especialidades.html">Especialidades</a></li>
                    </ul>
                </li>
                <li class="dropdown">
                    <a href="#">Docentes</a>
                    <ul class="submenu">
                        <li><a href="calendario.html">Cronograma de Actividades</a></li>
                        <li><a href="sistemas-ministerio-educacion.html">Sistemas del Ministerio de Educación</a></li>
                        <li><a href="https://recursos.educacion.gob.ec/" target="_blank" rel="noopener">Recursos Didácticos</a></li>
                        <li><a href="https://aulavirtual.uevmg.com/" target="_blank" rel="noopener">Aula Virtual Institucional</a></li>
                        <li><a href="asistencia.html">Control de Asistencia</a></li>
                        <li><a href="promocion-estudiantes.html">Promociones</a></li>
                        <li><a href="https://academico.educarecuador.gob.ec/" target="_blank" rel="noopener">Ingreso de Notas Académico</a></li>
                    </ul>
                </li>
                <li class="dropdown">
                    <a href="#">Padres de Familia</a>
                    <ul class="submenu">
                        <li><a href="comite-padres.html">Comité Central de Padres de Familia</a></li>
                    </ul>
                </li>
                <li class="dropdown">
                    <a href="#">Estudiantes</a>
                    <ul class="submenu">
                        <li><a href="consejo-estudiantil.html">Consejo Estudiantil</a></li>
                        <li><a href="cuadro-honor.html">Cuadro de Honor</a></li>
                        <li><a href="horario-clases.html">Horario de Clases</a></li>
                        <li><a href="uniforme-escolar.html">Uniforme Escolar</a></li>
                    </ul>
                </li>
                <li class="dropdown">
                    <a href="#">Servicios</a>
                    <ul class="submenu">
                        <li><a href="dece.html">DECE</a></li>
                        <li><a href="bar-institucional.html">Bar Institucional</a></li>
                        <li><a href="banda-musical.html">Banda Musical</a></li>
                        <li><a href="biblioteca-virtual.html">Biblioteca Virtual</a></li>
                        <li><a href="bastoneras.html">Grupo de Bastoneras y Cachiporreros</a></li>
                    </ul>
                </li>
                <li><a href="contactos.html">Contactos</a></li>
            </ul>
        </nav>
    </div>
</header>
    <main>
        <div class="auth-container">
            <div class="auth-box">
                <img src="unidad-educativa-logo.png" alt="Escudo de la Institución" class="logo-login">
                <h2>Iniciar Sesión</h2>
                <form>
                    <label for="login-usuario">Correo Electrónico o Cédula:</label>
                    <input type="text" id="login-usuario" name="login-usuario" required>
                    <label for="login-password">Contraseña:</label>
                    <input type="password" id="login-password" name="login-password" required>
                    <div id="captcha-container">
                        <label for="captcha">Resuelve: <span id="captcha-question"></span></label>
                        <input type="text" id="captcha-answer" required>
                    </div>
                    <button type="submit">Iniciar Sesión</button>
                </form>
                <div class="login-footer-links">
                    ¿No tienes cuenta?
                    <a href="registro.html">Regístrate</a>
                    |
                    <a href="index.html">Volver al inicio</a>
                </div>
            </div>
        </div>
    </main>
    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>UNIDAD EDUCATIVA "VICTOR MANUEL GUZMAN"</h3>
                <div class="footer-line"></div>
                <p>Todos los contenidos digitales del portal web, se prohíbe su reproducción total, parcial y traducción a cualquier idioma sin autorización escrita por su titular.</p>
            </div>
            <div class="footer-section">
                <h3>ACCESOS DIRECTOS</h3>
                <div class="footer-line"></div>
                <ul>
                    <li><a href="index.html">Inicio</a></li>
                    <li><a href="registro.html">Registro</a></li>
                    <li><a href="#autoridades">Autoridades</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>CONTACTOS</h3>
                <div class="footer-line"></div>
                <p>(09) 096 305 3811</p>
                <p> uevmg2023@gmail.com</p>
                <p>De lunes a viernes: 07:00 - 17:00</p>
            </div>
            <div class="footer-section">
                <h3>UBICACIÓN</h3>
                <div class="footer-line"></div>
                <div style="margin-top:5px; text-align:center;">
                    <iframe 
                        src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d1994.874824133404!2d-78.11604869660802!3d0.33616444871436085!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x8e2a3cd3c813c32d%3A0xf395292710b25406!2sUnidad%20Educativa%20V%C3%ADctor%20Manuel%20Guzm%C3%A1n!5e0!3m2!1ses-419!2sec!4v1744093697198!5m2!1ses-419!2sec" 
                        width="180" height="110" style="border:0;border-radius:8px;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade">
                    </iframe>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>Unidad Educativa Victor Manuel Guzmán © Copyrights 2025 Realizado por Dominick López, Juan Alba y Hugo Castillo</p>
        </div>
    </footer>
    <script type="module">
        import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

        // Configuración de Supabase
        const supabaseUrl = "https://zeijayrxciyzymysbyvp.supabase.co";
        const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InplaWpheXJ4Y2l5enlteXNieXZwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQxNjYyMjMsImV4cCI6MjA1OTc0MjIyM30.DxT8_5acA88JxhVV7n2UqmrZ_9d0DPABi6eKSO8cpDE";
        const supabase = createClient(supabaseUrl, supabaseKey);

        document.querySelector('form').addEventListener('submit', async function (e) {
            e.preventDefault();

            const captchaAnswer = document.getElementById('captcha-answer').value.trim();
            const captchaCorrectAnswer = document.getElementById('captcha-container').dataset.correctAnswer;

            if (captchaAnswer !== captchaCorrectAnswer) {
                alert('Respuesta incorrecta. Por favor, resuelve el captcha correctamente.');
                return;
            }

            const email = document.getElementById('login-usuario').value.trim();
            const password = document.getElementById('login-password').value;

            if (!email || !password) {
                alert('Por favor, completa todos los campos.');
                return;
            }

            try {
                const { data: usuarios, error } = await supabase
                    .from('usuarios')
                    .select('*')
                    .eq('email', email);

                if (error) {
                    console.error('Error al verificar las credenciales:', error.message);
                    alert('Ocurrió un error al verificar las credenciales.');
                    return;
                }

                if (usuarios && usuarios.length > 0) {
                    const usuario = usuarios[0];
                    if (usuario.password === password) {
                        localStorage.setItem('usuarioActivo', email);
                        alert('Inicio de sesión exitoso.');
                        window.location.href = 'index.html';
                    } else {
                        alert('Correo o contraseña incorrectos.');
                    }
                } else {
                    alert('Correo o contraseña incorrectos.');
                }
            } catch (err) {
                console.error('Error inesperado:', err);
                alert('Ocurrió un error inesperado. Por favor, intenta nuevamente.');
            }
        });

        // Generar un captcha simple
        function generarCaptcha() {
            const num1 = Math.floor(Math.random() * 10) + 1;
            const num2 = Math.floor(Math.random() * 10) + 1;
            const question = `${num1} + ${num2}`;
            const answer = (num1 + num2).toString();

            document.getElementById('captcha-question').textContent = question;
            document.getElementById('captcha-container').dataset.correctAnswer = answer;
        }

        generarCaptcha();

        // Verificar si el usuario activo es administrador
        const adminEmail = localStorage.getItem('adminEmail') || 'admin@ejemplo.com'; // Valor predeterminado
        const usuarioActivo = localStorage.getItem('usuarioActivo');
        const menu = document.querySelector('.menu');

        if (usuarioActivo === adminEmail) {
            const adminMenuItem = document.createElement('li');
            adminMenuItem.innerHTML = '<a href="verUsuarios.html">Administración</a>';
            menu.appendChild(adminMenuItem);
        }
    </script>
    <script src="script.js" defer></script>
</body>
</html>
