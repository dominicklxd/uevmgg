<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Victor Manuel Guzman</title>
    <link rel="stylesheet" href="css.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script> <!-- Cargar Supabase -->
    <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@400;700&display=swap" rel="stylesheet"> <!-- Fuente Raleway -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@400;700&display=swap" rel="stylesheet"> <!-- Fuente Roboto Slab -->
    <link href="https://fonts.googleapis.com/css2?family=Lobster&display=swap" rel="stylesheet"> <!-- Fuente Lobster -->
    <link rel="shortcut icon" href="/unidad-educativa-logo.png" />
</head>
<body>
    <div class="top-bars">
        <div class="top-bar-1"></div>
        <div class="top-bar-2"></div>
    </div>
    
    <img src="referencia.png" alt="Imagen de referencia" style="display: block; margin: 0 auto; margin-top: 10px;"> <!-- Imagen de referencia encima del encabezado -->
    <header>
        <div class="header-top">
            
            <img src="unidad-educativa-logo.png" alt="Logo de la Institución" class="logo">
            <div class="header-text">
                <h1>Unidad Educativa </h1>
                <h1>"Víctor Manuel Guzmán"</h1>
                <p>50 años de Educación Estudiantil</p>
            </div>
            <div class="auth-links">
                <!-- Los enlaces se gestionarán dinámicamente desde script.js -->
            </div>
            <div id="saludo-usuario" style="position:absolute; right:30px; bottom:-30px; font-size:1.1rem; color:#2f5597; font-weight:bold; background:rgba(255,255,255,0.95); border-radius:8px; padding:0.3em 1em; box-shadow:0 2px 8px rgba(0,0,0,0.08); display:none; z-index:10;">
                <!-- Aquí se mostrará el saludo -->
            </div>
            <nav>
                <ul class="menu">
                    <li><a href="index.html">Inicio</a></li>
                    <li class="dropdown">
                        <a href="#">Nosotros</a>
                        <ul class="submenu">
                            <li><a href="quienes-somos.html">Quiénes Somos</a></li>
                            <li><a href="autoridades.html">Autoridades</a></li>
                            <li><a href="historia.html">Historia</a></li>
                            <li><a href="ambientes.html">Sede y Ambientes</a></li>
                            <li><a href="simbolos.html">Símbolos Institucionales</a></li>
                            <li><a href="oferta-educativa.html">Oferta Educativa</a></li>
                            <li><a href="especialidades.html">Especialidades</a></li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#">Docentes</a>
                        <ul class="submenu">
                            <li><a href="calendario.html">Cronograma de Actividades</a></li>
                            <li><a href="sistemas-ministerio-educacion.html">Sistemas del Ministerio de Educación</a></li>
                            
                            <li><a href="#recursos">Recursos Didácticos</a></li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#">Padres de Familia</a>
                        <ul class="submenu">
                            <li><a href="comite-padres.html">Comité Central de Padres de Familia</a></li>
                            <li><a href="#horario-padres">Horario de Atención a Padres de Familia</a></li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#">Estudiantes</a>
                        <ul class="submenu">
                            <li><a href="consejo-estudiantil.html">Consejo Estudiantil</a></li>
                            <li><a href="cuadro-honor.html">Cuadro de Honor</a></li>
                            <li><a href="horario-clases.html">Horario de Clases</a></li>
                            <li><a href="#uniforme-escolar">Uniforme Escolar</a></li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#">Servicios</a>
                        <ul class="submenu">
                            <li><a href="#aula-virtual">Aula Virtual Institucional</a></li>
                            <li><a href="dece.html">DECE</a></li>
                           
                            
                            <li><a href="#bar-institucional">Bar Institucional</a></li>
                            <li><a href="#banda-musical">Banda Musical</a></li>
                            <li><a href="#biblioteca-virtual">Biblioteca Virtual</a></li>
                            
                            <li><a href="#bastoneras">Grupo de Bastoneras y Cachiporreros</a></li>
                        </ul>
                    </li>
                    <li><a href="contactos.html">Contactos</a></li>
                </ul>
            </nav>
        </div>
    </header>
    <!-- Burbujas flotantes para auth-links (fuera del header) -->
    <div class="floating-bubbles" style="display:none;">
        <!-- Las burbujas se llenan dinámicamente por JS -->
    </div>
    <main style="margin-top: 120px;"> <!-- Ajustar el contenido para evitar que quede detrás del encabezado -->
        <section id="inicio" class="centered-section">
            <!-- Título animado -->
            <div class="animated-title">
                <h1 style="font-family: 'Lobster', cursive;">
                    <span>V</span><span>Í</span><span>C</span><span>T</span><span>O</span><span>R</span><span> </span><SPAN></SPAN>
                    <span>M</span><span>a</span><span>N</span><span>U</span><span>E</span><span>L</span><span></span><span></span>
                    <span>G</span><span>U</span><span>Z</span><span>M</span><span>Á</span><span>N</span><span></span><span></span>
                </h1>
                <p>La excelencia educativa es nuestra pasión</p>
            </div>
            

            <div class="carousel">
                <div class="progress-bar"></div> <!-- Barra de carga -->
                <button class="carousel-btn prev-btn">&#8249;</button>
                <div class="carousel-images">
                    <img src="estandarte.png" alt="Fotografía Institucional 1" class="active">
                    <img src="rector.png" alt="Fotografía Institucional 2">
                    <img src="estandarte.jpg" alt="Fotografía Institucional 3">
                </div>
                <button class="carousel-btn next-btn">&#8250;</button>
            </div>
            <section id="servicios-educativos" class="centered-section">
                <h2 class="section-title">BIENVENIDA A LA INSTITUCION</h2>
                <div class="section-divider">
                    <span class="line"></span>
                    <span class="icon">
                        <img src="graduation-icon.png" alt="Icono de graduación">
                    </span>
                    <span class="line"></span>
                </div>
                <section id="mision-vision" class="centered-section">
                    <div class="mision-vision-container">
                        <div id="mision" class="option">
                            <img src="unidad-educativa-logo.png" alt="Imagen representativa de la misión" style="width: 30%; height: auto; border-radius: 8px; margin-bottom: 1rem;">
                            <h2 style="text-align: center; color: #000308; font-size: 1.8rem; font-weight: bold;">MISIÓN</h2>
                            <p style="text-align: justify; font-size: 1rem; color: #333; line-height: 1.6;">
                                Formar seres humanos íntegros, indagadores de mentalidad abierta, con excelencia académica, competencias científicas y técnicas acordes a las exigencias actuales, capaces de desenvolverse en la cotidianidad bajo sólidos principios éticos y morales, incorporándolos como ciudadanos del mundo.
                            </p>
                        </div>
                        <div id="vision" class="option">
                            <img src="unidad-educativa-logo.png" alt="Imagen representativa de la visión" style="width: 30%; height: auto; border-radius: 8px; margin-bottom: 1rem;">
                            <h2 style="text-align: center; color: #000308; font-size: 1.8rem; font-weight: bold;">VISIÓN</h2>
                            <p style="text-align: justify; font-size: 1rem; color: #333; line-height: 1.6;">
                                Constituirse en el futuro en una de las mejores Unidades Educativas con oferta del bachillerato internacional y el bachillerato técnico, formando personas integras, vinculando la teoría con la práctica, buscando la excelencia académica y profesional para el servicio de la sociedad ecuatoriana y el mundo.
                            </p>
                        </div>
                    </div>
                </section>
            </section>
            <section id="servicios-educativos" class="centered-section">
                <h2 class="section-title">SERVICIOS EDUCATIVOS</h2>
                <div class="section-divider">
                    <span class="line"></span>
                    <span class="icon">
                        <img src="graduation-icon.png" alt="Icono de graduación">
                    </span>
                    <span class="line"></span>
                </div>

                <div class="options-box">
                    <a href="https://aulavirtual.uevmg.com/" class="service-button">
                        <img src="aulas-virtuales.png" alt="Aulas Virtuales">
                        <h3>Aulas Virtuales</h3>
                        <p>Aulas virtuales Moodle UEVMG.</p>
                    </a>
                    <a href="correo-institucional.html" class="service-button">
                        <img src="correo-institucional.png" alt="Correo Institucional">
                        <h3>Correo Institucional</h3>
                        <p>Plataforma de acceso al correo institucional</p>
                    </a>
                    <a href="https://juntos.educacion.gob.ec/index.php/consulta-sierra/asignacion" class="service-button">
                        <img src="logo4.png" alt="Actualización de Datos">
                        <h3>Consulta de Cupo</h3>
                        <p>Consultar datos para obtener un nuevo cupo.</p>
                    </a>
                    <a href="https://www.facebook.com/uevictormanuelguzman/photos" class="service-button">
                        <img src="camara.png" alt="Actualización de Datos">
                        <h3>Galería de Fotos</h3>
                        <p>Recuerdos estudiantiles de la institución.</p>
                    </a>
                </div>
            <section id="redes-sociales" class="centered-section">
                <h2 class="section-title">REDES SOCIALES</h2>
                <div class="section-divider">
                    <span class="line"></span>
                    <span class="icon">
                        <img src="graduation-icon.png" alt="Icono de graduación">
                    </span>
                    <span class="line"></span>
                </div>

                <div class="options-box">
                    <a href="https://www.facebook.com/uevictormanuelguzman" class="service-button" target="_blank">
                        <img src="facebook.png" alt="Sistema Académico Institucional">
                        <h3>Facebook</h3>
                    </a>
                    <a href="https://www.instagram.com/banda_vmg?igsh=N3hpeGd2azczOTE1" class="service-button">
                        <img src="instagram.png" alt="Aulas Virtuales">
                        <h3>Instagram</h3>
                    </a>
                    <a href="correo-institucional.html" class="service-button">
                        <img src="youtube.png" alt="Correo Institucional">
                        <h3>Youtube</h3>
                    </a>

                </div>
            </section>
            <!-- Nuevo recuadro para otro subtema -->

            <section class="fifty-years-section centered-section">
                <h2 class="section-title">50 Años de la Institución</h2>
                <p class="section-subtitle">Celebramos medio siglo de excelencia educativa</p>
                <div class="fifty-years-images">
                    <!-- Imagen normal -->
                    <img src="50years1.jpg" alt="Celebración 50 años - Imagen 1">
                    <!-- Imagen con enlace que abre en nueva pestaña -->
                    <a href="https://www.calameo.com/read/0069611049c0b244a5cb8" target="_blank" rel="noopener">
                        <img src="50years3.jpg" alt="Celebración 50 años - Imagen 3">
                    </a>
                    <!-- Imagen normal -->
                    <img src="50years2.jpg" alt="Celebración 50 años - Imagen 2">
                </div>
            </section>
            <!-- NUEVA SECCIÓN: Últimas Noticias -->
            <section id="noticias" class="centered-section" style="margin-top:3rem; background: #fff; border-radius: 18px; box-shadow: 0 8px 32px rgba(44,130,201,0.10); max-width: 1200px; margin-left:auto; margin-right:auto; padding:2.5rem 2rem;">
                <h2 class="section-title">Últimas Noticias</h2>
                <div class="section-divider">
                    <span class="line"></span>
                    <span class="icon">
                        <img src="graduation-icon.png" alt="Icono de graduación">
                    </span>
                    <span class="line"></span>
                </div>
                <div id="noticias-lista" style="display: flex; flex-wrap: wrap; gap: 2rem; justify-content: center;">
                    <!-- Aquí se mostrarán las noticias dinámicamente -->
                </div>
                <div style="text-align:center; margin-top:2rem;">
                    <a href="crear-noticia.html" id="btn-publicar-noticia" class="btn-descargar publicar-noticia-btn">
                        <span style="display:inline-flex;align-items:center;gap:0.5em;">
                            <svg width="22" height="22" fill="none" viewBox="0 0 24 24" style="vertical-align:middle;">
                                <path d="M12 4v16m8-8H4" stroke="#fff" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            Publicar Noticia <span style="font-size:0.95em;opacity:0.7;">(solo anunciadores)</span>
                        </span>
                    </a>
                </div>
            </section>
        </section>

    </main>
   <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>UNIDAD EDUCATIVA "VICTOR MANUEL GUZMAN"</h3>
                <div class="footer-line"></div>
                <p>Todos los contenidos digitales del portal web, se prohíbe su reproducción total, parcial y traducción a cualquier idioma sin autorización escrita por su titular.</p>
            </div>
            <div class="footer-section">
                <h3>ACCESOS DIRECTOS</h3>
                <div class="footer-line"></div>
                <ul>
                    <li><a href="index.html">Inicio</a></li>
                    <li><a href="registro.html">Registro</a></li>
                    <li><a href="#autoridades">Autoridades</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>CONTACTOS</h3>
                <div class="footer-line"></div>
                <p>(09) 096 305 3811</p>
                <p> uevmg2023@gmail.com</p>
                <p>De lunes a viernes: 07:00 - 17:00</p>
            </div>
                        <div class="footer-section">
                <h3>UBICACIÓN</h3>
                <div class="footer-line"></div>
                
                <!-- Mapa pequeño, fijo, debajo del texto -->
                <div style="margin-top:5px; text-align:center;">
                    <iframe 
                        src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d1994.874824133404!2d-78.11604869660802!3d0.33616444871436085!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x8e2a3cd3c813c32d%3A0xf395292710b25406!2sUnidad%20Educativa%20V%C3%ADctor%20Manuel%20Guzm%C3%A1n!5e0!3m2!1ses-419!2sec!4v1744093697198!5m2!1ses-419!2sec" 
                        width="180" height="110" style="border:0;border-radius:8px;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade">
                    </iframe>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>Unidad Educativa Victor Manuel Guzmán © Copyrights 2025 Realizado por Dominick López, Juan Alba y Hugo Castillo
                +-
            </p>
        </div>
        
    </footer>
    <script src="script.js"></script>
    <script>
        const authLinks = document.querySelector('.auth-links');
        const usuarioActivo = localStorage.getItem('usuarioActivo');

        // Mostrar saludo personalizado consultando la base de datos Supabase
        async function mostrarSaludoUsuario() {
            const saludoDiv = document.getElementById('saludo-usuario');
            if (!usuarioActivo) {
                saludoDiv.style.display = 'none';
                return;
            }
            // Configuración de Supabase
            const supabaseUrl = "https://zeijayrxciyzymysbyvp.supabase.co";
            const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InplaWpheXJ4Y2l5enlteXNieXZwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQxNjYyMjMsImV4cCI6MjA1OTc0MjIyM30.DxT8_5acA88JxhVV7n2UqmrZ_9d0DPABi6eKSO8cpDE";
            // Siempre crear el cliente, no dependas de window.supabase
            const supabase = window.supabase && window.supabase.createClient
                ? window.supabase.createClient(supabaseUrl, supabaseKey)
                : (typeof window.supabase === "undefined" && typeof window.supabaseJs !== "undefined")
                    ? window.supabaseJs.createClient(supabaseUrl, supabaseKey)
                    : (window.supabase_createClient ? window.supabase_createClient(supabaseUrl, supabaseKey) : null);

            // Si no se pudo crear el cliente, intenta de nuevo con la forma estándar
            const supabaseClient = supabase || (typeof window.supabase !== "undefined" ? window.supabase.createClient(supabaseUrl, supabaseKey) : null);
            if (!supabaseClient) {
                saludoDiv.style.display = 'none';
                return;
            }
            // Buscar el estudiante por cédula (usuarioActivo)
            let nombre = '';
            try {
                // Primero, buscar el id_cedula en la tabla 'cedulas'
                let { data: cedulaData, error: cedulaError } = await supabaseClient
                    .from('cedulas')
                    .select('id_cedula')
                    .eq('cedula', usuarioActivo)
                    .maybeSingle();

                let idCedula = cedulaData && cedulaData.id_cedula ? cedulaData.id_cedula : null;

                // Si se encontró el id_cedula, buscar el estudiante por ese id
                if (idCedula) {
                    let { data: estudianteData, error: estudianteError } = await supabaseClient
                        .from('estudiante')
                        .select('nombres')
                        .eq('id_cedula', idCedula)
                        .order('id_estudiante', { ascending: false })
                        .limit(1)
                        .maybeSingle();
                    if (estudianteData && estudianteData.nombres) {
                        nombre = estudianteData.nombres.trim().split(' ')[0];
                    }
                }

                // Si no se encontró por id_cedula, intenta buscar por cedula directa (por si acaso)
                if (!nombre) {
                    let { data: estudianteData2 } = await supabaseClient
                        .from('estudiante')
                        .select('nombres')
                        .eq('cedula', usuarioActivo)
                        .order('id_estudiante', { ascending: false })
                        .limit(1)
                        .maybeSingle();
                    if (estudianteData2 && estudianteData2.nombres) {
                        nombre = estudianteData2.nombres.trim().split(' ')[0];
                    }
                }
            } catch (e) {
                nombre = '';
            }
            if (nombre) {
                saludoDiv.textContent = `Hola, ${nombre}`;
                saludoDiv.style.display = 'block';
            } else {
                saludoDiv.textContent = '';
                saludoDiv.style.display = 'none';
            }
        }

        if (authLinks) {
            if (usuarioActivo) {
                // Construir los enlaces como elementos para asegurar el orden visual
                authLinks.innerHTML = '';
                const linkMatricularse = document.createElement('a');
                linkMatricularse.href = 'matricularse.html';
                linkMatricularse.textContent = 'Matricularse';

                const linkCerrarSesion = document.createElement('a');
                linkCerrarSesion.href = '#';
                linkCerrarSesion.id = 'logout';
                linkCerrarSesion.textContent = 'Cerrar Sesión';

                const linkPerfil = document.createElement('a');
                linkPerfil.href = 'perfil.html';
                linkPerfil.textContent = 'Perfil';
                linkPerfil.style.display = 'block';
                linkPerfil.style.marginTop = '8px';
                linkPerfil.style.paddingRight = '10px';

                authLinks.appendChild(linkMatricularse);
                authLinks.appendChild(linkPerfil); // Mostrar "Perfil" antes de cerrar sesión
                authLinks.appendChild(linkCerrarSesion);

                document.getElementById('logout').addEventListener('click', (e) => {
                    e.preventDefault();
                    localStorage.removeItem('usuarioActivo');
                    alert('Sesión cerrada exitosamente.');
                    window.location.href = 'index.html';
                });
                mostrarSaludoUsuario();
            } else {
                authLinks.innerHTML = `
                    <a href="registro.html">Registrarse</a>
                    <a href="login.html">Iniciar Sesión</a>
                `;
                document.getElementById('saludo-usuario').style.display = 'none';
            }
        }

        // Si el usuario inicia sesión después, también mostrar el saludo
        window.addEventListener('storage', function(e) {
            if (e.key === 'usuarioActivo') {
                mostrarSaludoUsuario();
            }
        });

        // Burbujas flotantes dinámicas según sesión
        function renderFloatingBubbles() {
            const bubbles = document.querySelector('.floating-bubbles');
            if (!bubbles) return;
            bubbles.innerHTML = '';
            const usuarioActivo = localStorage.getItem('usuarioActivo');
            if (usuarioActivo) {
                // Usuario autenticado
                bubbles.innerHTML = `
                    <a href="matricularse.html" class="floating-bubble" title="Matricularse">
                        <img src="icon-matricularse.png" alt="Matricularse">
                        <span class="floating-bubble-label">Matricularse</span>
                    </a>
                    <a href="perfil.html" class="floating-bubble" title="Perfil">
                        <img src="icon-perfil.png" alt="Perfil">
                        <span class="floating-bubble-label">Perfil</span>
                    </a>
                    <a href="#" class="floating-bubble" id="cerrar-sesion-bubble" title="Cerrar sesión">
                        <img src="icon-cerrar.png" alt="Cerrar sesión">
                        <span class="floating-bubble-label">Cerrar sesión</span>
                    </a>
                `;
                // Cerrar sesión desde la burbuja
                setTimeout(() => {
                    const cerrar = document.getElementById('cerrar-sesion-bubble');
                    if (cerrar) {
                        cerrar.onclick = function(e) {
                            e.preventDefault();
                            localStorage.removeItem('usuarioActivo');
                            window.location.href = "login.html";
                        };
                    }
                }, 50);
            } else {
                // Usuario NO autenticado
                bubbles.innerHTML = `
                    <a href="registro.html" class="floating-bubble" title="Registrarse">
                        <img src="icon-registrarse.png" alt="Registrarse">
                        <span class="floating-bubble-label">Registrarse</span>
                    </a>
                    <a href="login.html" class="floating-bubble" title="Iniciar sesión">
                        <img src="  .png" alt="Iniciar sesión">
                        <span class="floating-bubble-label">Iniciar sesión</span>
                    </a>
                `;
            }
        }

        // Mostrar burbujas al hacer scroll y al cargar/cambiar sesión
        const header = document.querySelector('header');
        const bubbles = document.querySelector('.floating-bubbles');
        function toggleBubbles() {
            if (window.scrollY > 30) {
                header.classList.add('scrolled');
                if (bubbles) bubbles.style.display = 'flex';
            } else {
                header.classList.remove('scrolled');
                if (bubbles) bubbles.style.display = 'none';
            }
        }
        window.addEventListener('scroll', toggleBubbles);
        window.addEventListener('storage', function(e) {
            if (e.key === 'usuarioActivo') {
                renderFloatingBubbles();
            }
        });
        // Inicializar burbujas al cargar
        renderFloatingBubbles();
        toggleBubbles();

        // --- Mostrar noticias desde Supabase ---
        const supabaseUrl = "https://zeijayrxciyzymysbyvp.supabase.co";
        const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InplaWpheXJ4Y2l5enlteXNieXZwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQxNjYyMjMsImV4cCI6MjA1OTc0MjIyM30.DxT8_5acA88JxhVV7n2UqmrZ_9d0DPABi6eKSO8cpDE";
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        async function cargarNoticias() {
            const noticiasDiv = document.getElementById('noticias-lista');
            noticiasDiv.innerHTML = '<p style="width:100%;text-align:center;">Cargando noticias...</p>';

            let { data: noticias, error } = await supabase
                .from('noticias')
                .select('*')
                .order('fecha', { ascending: false })
                .limit(20);

            if (error || !noticias || noticias.length === 0) {
                noticiasDiv.innerHTML = '<p style="width:100%;text-align:center;">No hay noticias publicadas.</p>';
                return;
            }

            // Obtener nombres de estudiantes/autores si quieres mostrar el nombre real
            const estudiantesNombres = {};
            for (const noticia of noticias) {
                if (noticia.id_estudiante && !estudiantesNombres[noticia.id_estudiante]) {
                    let { data: estudiante } = await supabase
                        .from('estudiante')
                        .select('nombres')
                        .eq('id_estudiante', noticia.id_estudiante)
                        .maybeSingle();
                    estudiantesNombres[noticia.id_estudiante] = estudiante ? estudiante.nombres : '';
                }
            }

            noticiasDiv.innerHTML = '';

            // Noticia principal
            const noticiaPrincipal = noticias[0];
            let fechaPrincipal = noticiaPrincipal.fecha ? new Date(noticiaPrincipal.fecha).toLocaleString('es-EC', { dateStyle: 'medium', timeStyle: 'short' }) : '';
            let nombreAutorPrincipal = estudiantesNombres[noticiaPrincipal.id_estudiante] || noticiaPrincipal.autor || 'Anónimo';
            let archivoHtmlPrincipal = '';
            if (noticiaPrincipal.archivo_url) {
                const ext = noticiaPrincipal.archivo_url.split('.').pop().toLowerCase();
                if (['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(ext)) {
                    archivoHtmlPrincipal = `<div style="margin:1em 0;text-align:center;">
                        <img src="${noticiaPrincipal.archivo_url}" alt="Imagen de la noticia" style="max-width:100%;max-height:420px;border-radius:18px;box-shadow:0 4px 24px rgba(44,130,201,0.18);object-fit:cover;">
                    </div>`;
                } else {
                    archivoHtmlPrincipal = `<div><a href="${noticiaPrincipal.archivo_url}" target="_blank" style="color:#2f5597;font-weight:bold;">Descargar archivo</a></div>`;
                }
            }
            noticiasDiv.innerHTML += `
                <div class="noticia-principal" style="background:linear-gradient(120deg,#eaf2fb 70%,#d4e6f7 100%); border-radius:22px; box-shadow:0 6px 32px rgba(44,130,201,0.13); padding:2.5rem 2rem 2rem 2rem; margin-bottom:2.5rem; width:100%; max-width:900px; margin-left:auto; margin-right:auto; position:relative;">
                    <span style="position:absolute;top:18px;right:28px;background:#548235;color:#fff;padding:0.3em 1em;border-radius:8px;font-size:1rem;font-weight:bold;box-shadow:0 2px 8px rgba(44,130,201,0.10);letter-spacing:1px;">Noticia principal</span>
                    <h2 style="color:#2f5597; font-size:2.2rem; margin-bottom:0.7em; font-family:'Roboto Slab',serif;">${noticiaPrincipal.titulo}</h2>
                    ${archivoHtmlPrincipal}
                    <div style="font-size:1.15rem; color:#222; margin-bottom:1.1em; line-height:1.6; font-family:'Raleway',sans-serif;">${noticiaPrincipal.contenido}</div>
                    <div style="font-size:1rem; color:#548235; margin-bottom:0.4em;"><b>Autor:</b> ${nombreAutorPrincipal}</div>
                    <div style="font-size:0.95rem; color:#888; margin-bottom:0.4em;"><b>Fecha:</b> ${fechaPrincipal}</div>
                </div>
            `;

            // Noticias secundarias en carrusel
            if (noticias.length > 1) {
                noticiasDiv.innerHTML += `
                    <div class="noticias-secundarias-carrusel" style="position:relative; width:100%; max-width:1100px; margin:0 auto;">
                        <button id="carrusel-prev" class="carrusel-flecha" style="left:-30px;">&#8249;</button>
                        <div id="carrusel-contenedor" style="display:flex; gap:2rem; justify-content:center; align-items:stretch; min-height:360px; transition:all 0.3s;"></div>
                        <button id="carrusel-next" class="carrusel-flecha" style="right:-30px;">&#8250;</button>
                    </div>
                `;

                // Carrusel lógica
                const secundarias = noticias.slice(1);
                let carruselIndex = 0;
                const mostrarNoticiasCarrusel = () => {
                    const cont = document.getElementById('carrusel-contenedor');
                    cont.innerHTML = '';
                    for (let i = carruselIndex; i < Math.min(carruselIndex + 3, secundarias.length); i++) {
                        const noticia = secundarias[i];
                        let fecha = noticia.fecha ? new Date(noticia.fecha).toLocaleString('es-EC', { dateStyle: 'medium', timeStyle: 'short' }) : '';
                        let nombreAutor = estudiantesNombres[noticia.id_estudiante] || noticia.autor || 'Anónimo';
                        let archivoHtml = '';
                        if (noticia.archivo_url) {
                            const ext = noticia.archivo_url.split('.').pop().toLowerCase();
                            if (['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(ext)) {
                                archivoHtml = `<div style="margin:1em 0;text-align:center;">
                                    <img src="${noticia.archivo_url}" alt="Imagen de la noticia" style="max-width:100%;max-height:160px;border-radius:10px;box-shadow:0 2px 8px rgba(44,130,201,0.10);object-fit:cover;">
                                </div>`;
                            } else {
                                archivoHtml = `<div><a href="${noticia.archivo_url}" target="_blank" style="color:#2f5597;font-weight:bold;">Descargar archivo</a></div>`;
                            }
                        }
                        cont.innerHTML += `
                            <div class="noticia-card" style="background:linear-gradient(120deg,#f8fafd 70%,#eaf2fb 100%); border-radius:14px; box-shadow:0 2px 12px rgba(44,130,201,0.10); padding:1.2rem; max-width:320px; min-width:220px; display:flex; flex-direction:column; justify-content:space-between; transition:box-shadow 0.2s;">
                                <h3 style="color:#2f5597; font-size:1.25rem; margin-bottom:0.5em; font-family:'Roboto Slab',serif;">${noticia.titulo}</h3>
                                ${archivoHtml}
                                <div style="font-size:0.98rem; color:#444; margin-bottom:0.7em; line-height:1.5; font-family:'Raleway',sans-serif;">${noticia.contenido}</div>
                                <div style="font-size:0.93rem; color:#548235; margin-bottom:0.4em;"><b>Autor:</b> ${nombreAutor}</div>
                                <div style="font-size:0.85rem; color:#888; margin-bottom:0.4em;"><b>Fecha:</b> ${fecha}</div>
                            </div>
                        `;
                    }
                    // Ocultar flechas si no hay más noticias
                    document.getElementById('carrusel-prev').style.visibility = carruselIndex > 0 ? 'visible' : 'hidden';
                    document.getElementById('carrusel-next').style.visibility = (carruselIndex + 3 < secundarias.length) ? 'visible' : 'hidden';
                };

                // Inicializar carrusel
                setTimeout(() => {
                    mostrarNoticiasCarrusel();
                    document.getElementById('carrusel-prev').onclick = () => {
                        if (carruselIndex > 0) {
                            carruselIndex -= 3;
                            mostrarNoticiasCarrusel();
                        }
                    };
                    document.getElementById('carrusel-next').onclick = () => {
                        if (carruselIndex + 3 < secundarias.length) {
                            carruselIndex += 3;
                            mostrarNoticiasCarrusel();
                        }
                    };
                }, 50);
            }
        }

        // Cargar noticias al cargar la página
        document.addEventListener('DOMContentLoaded', cargarNoticias);
    </script>
    <!-- Agrega estilos para el carrusel y tarjetas de noticias -->
    <script>
        const style = document.createElement('style');
        style.innerHTML = `
            .noticia-card:hover {
                box-shadow: 0 6px 24px rgba(44,130,201,0.18);
                transform: translateY(-4px) scale(1.025);
                transition: box-shadow 0.2s, transform 0.2s;
            }
            .carrusel-flecha {
                position: absolute;
                top: 40%;
                z-index: 2;
                background: linear-gradient(120deg,#2f5597 60%,#548235 100%);
                color: #fff;
                border: none;
                border-radius: 50%;
                width: 44px;
                height: 44px;
                font-size: 2rem;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                box-shadow: 0 2px 8px rgba(44,130,201,0.13);
                transition: background 0.2s, transform 0.2s;
            }
            .carrusel-flecha:hover {
                background: linear-gradient(120deg,#548235 60%,#2f5597 100%);
                transform: scale(1.12);
            }
            @media (max-width: 900px) {
                .noticia-principal { padding: 1.2rem !important; }
                .noticias-secundarias-carrusel { max-width: 98vw !important; }
                #carrusel-contenedor { gap: 1rem !important; }
            }
            @media (max-width: 700px) {
                .noticia-principal { font-size: 1rem !important; }
                #carrusel-contenedor { flex-direction: column !important; align-items: center !important; }
                .noticia-card { max-width: 98vw !important; min-width: 0 !important; }
                .carrusel-flecha { top: unset !important; bottom: -30px !important; left: 30% !important; right: 30% !important; }
            }
        `;
        document.head.appendChild(style);
    </script>
    <script>
        // Agrega estilos para el botón de publicar noticia
        const styleBtn = document.createElement('style');
        styleBtn.innerHTML = `
            .publicar-noticia-btn {
                background: linear-gradient(90deg, #2f5597 60%, #548235 100%);
                color: #fff !important;
                font-weight: bold;
                font-size: 1.18rem;
                border: none;
                border-radius: 12px;
                padding: 0.85em 2.5em;
                box-shadow: 0 4px 18px rgba(44,130,201,0.13);
                cursor: pointer;
                transition: background 0.18s, transform 0.18s, box-shadow 0.18s;
                text-decoration: none !important;
                letter-spacing: 0.5px;
                display: inline-block;
                margin: 0 auto;
            }
            .publicar-noticia-btn:hover, .publicar-noticia-btn:focus {
                background: linear-gradient(90deg, #548235 60%, #2f5597 100%);
                color: #fff !important;
                transform: translateY(-2px) scale(1.04);
                box-shadow: 0 8px 28px rgba(44,130,201,0.18);
                text-decoration: none !important;
            }
            .publicar-noticia-btn svg {
                margin-right: 0.2em;
                margin-bottom: 2px;
            }
        `;
        document.head.appendChild(styleBtn);
    </script>
</body>
</html>
